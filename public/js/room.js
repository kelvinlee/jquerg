// Generated by CoffeeScript 1.6.3
var createEditor, editor, editorList, path, popshow, read, socket;

read = true;

path = "ace/mode/";

popshow = function(id) {};

editorList = [];

createEditor = function(name, type) {
  var Box, C, D, E;
  if (type == null) {
    type = 'javascript';
  }
  name = 'jquerg_' + name;
  C = $('<pre>');
  D = $('<div>');
  Box = D.clone().addClass('box');
  Box.append;
  D.addClass('editor_ctrl clearfix');
  D.append(Box);
  C.attr('id', name);
  C.addClass('editor');
  $('#editorlist').append(C);
  $('#editorlist').append(D);
  E = ace.edit(name);
  E.setTheme("ace/theme/twilight");
  return E.getSession().setMode(path + type);
};

editor = ace.edit("main");

editor.setTheme("ace/theme/twilight");

editor.getSession().setMode(path + "javascript");

socket = io.connect('http://localhost:8888');

socket.on('online list', function(data) {
  return $("#n_p").text(data.length);
});

socket.emit('login', {
  data: 'first'
});

socket.on('get default info', function(data) {
  return socket.emit('create default info', {
    who: data.who,
    content: editor.getSession().getValue()
  });
});

socket.on('create default info', function(data) {
  read = false;
  editor.getSession().setValue(data.content);
  return read = true;
});

socket.on('editor', function(data) {
  read = false;
  editor.getSession().getDocument().applyDeltas([data.deltas]);
  return read = true;
});

$("[name=url]").val(window.location.href);

editor.on("change", function(e) {
  if (read) {
    return socket.emit('editor', {
      deltas: e.data
    });
  }
});

$(function() {
  $("select[name='modelist']").selectpicker({
    style: 'btn-primary',
    menuStyle: 'dropdown-inverse'
  });
  $("input[name=create]").click(function() {
    if ($("input[name=filename]").val()) {
      return createEditor($("input[name=filename]").val(), $("select[name='modelist']").val());
    } else {
      return alert('请输入文件名');
    }
  });
  $('.typcn-arrow-maximise').on('click', function() {
    var Mname;
    Mname = $(this).attr('for');
    $('#' + Mname).addClass('fullScreen');
    $(this).parents('.editor_ctrl').addClass('fullbox');
    $(this).addClass('hide');
    return $(this).next().removeClass('hide');
  });
  return $('.typcn-arrow-minimise').on('click', function() {
    var Mname;
    Mname = $(this).attr('for');
    $('#' + Mname).removeClass('fullScreen');
    $(this).parents('.editor_ctrl').removeClass('fullbox');
    $(this).addClass('hide');
    return $(this).prev().removeClass('hide');
  });
});
